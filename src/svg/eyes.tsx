import { Fragment, h } from "preact";
import { useEffect, useState } from "preact/hooks";
import styled, { keyframes } from "styled-components";
import { setRandomNumberByRange, IHitState } from "./../_utils";

const Eyes = (props: IHitState) => {
	const [isBlinking, setBlinking] = useState(false);

	// Let moles blink
	useEffect(() => {
		setInterval(() => {
			setBlinking(true);
			setTimeout(() => {
				setBlinking(false);
			}, 100);
		}, 2000);
	}, []);

	return (
		<Fragment>
			{props.isHit ? (
				<g id="eyeshit" style="transform:translate3d(0, 7px, 0);">
					<path
						fill-rule="evenodd"
						clip-rule="evenodd"
						fill="#000"
						d="M123.205 44.669c-.147.214-.29.43 0 .479-.407.954-1.244 1.477-1.681 2.4-2.697.223-5.152 2.011-6.959 3.84 3.522.478 6.49 1.51 8.399 3.601.091 1.771-1.312 2.048-1.68 3.36-2.151-1.492-4.979-1.967-8.88-1.44 2.169 2.231 6.692 4.051 6.96 9.12-.103.457-.687.434-.479 1.199-1.271-.07-1.622.779-1.681 1.92-1.729-1-1.964-2.979-2.88-4.559-1.577-2.721-4.484-3.65-7.439-5.041-.207-1.154-1.059-1.662-1.681-2.4.504-2.506.933-4.115 2.399-5.76.157-.175.596-.318.721-.479.143-.185.066-.773.24-.96.109-.117.613.121.72 0 2.102-2.391 4.888-4.9 7.92-6.48.501-.102.636.165.96.24.332-.547.879-.881 1.68-.96 1.087.674 2.089 1.433 3.361 1.92z"
					/>
					<path
						fill-rule="evenodd"
						clip-rule="evenodd"
						fill="#000"
						d="M85.711 55.05c-.234.766-.724.249-1.075.717.068.829.371 1.296.632 1.829-1.13 2.167-3.641 3.434-4.692 5.652-1.071-.233-1.932.72-2.384 1.486-1.156.116-1.857-.466-3.017-.345-.265-3.209 1.531-5.079 3.171-7.048-1.766-2.458-6.291-1.064-9.297-2.204-.982-.373-1.292-1.376-2.275-1.482-.02-.28-.14-.405-.334-.419-.2-.306.124-.682.271-1.038.296-.716.558-1.236 1.396-1.521 2.225-.758 7.136.021 9.419.461-.252-1.341-7.382-5.941-1.205-6.859 3.104 1.795 6.488 4.185 8.325 8.052.403.849.254 1.99 1.065 2.719z"
					/>
				</g>
			) : (
				<Fragment>
					<g id="blink" style={isBlinking ? { display: "block" } : { display: "none" }}>
						<path d="M84.289 61.6c-.151 2.641-1.868 2.004-3.958 1.747-3.667-.451-7.591.865-9.94-.923-.541-.862.208-1.618-.864-1.859.182-.44.948-.38.626-1.252 3.223-.663 7.534-.953 10.547-.567 1.155.997 2.389 1.905 3.589 2.854z" />
						<path d="M119.521 63.281c-4.635-.216-13.994 1.483-11.76-4.8 3.102-.285 8.672-.596 11.038.72 1.301.721 2.264 2.612.722 4.08z" />
					</g>
					<MovingEyes
						style={isBlinking ? { display: "none" } : { display: "block" }}
						eyedirection={setRandomNumberByRange(0, 1) ? "3.5%" : "-3.5%"}
						fill="#000"
						fill-rule="evenodd"
						clip-rule="evenodd"
					>
						<path
							fill="#000"
							d="M116.23 56.942c-.015-.013-.027-.023-.041-.037-1.142-.423-1.918-1.211-3.715-.978-1.459 1.606-3.611 3.615-2.879 6.24.551 1.972 3.445 2.44 5.521 3.12 2.194-1.363 2.993-3.467 2.665-6.881-.592-.382-1.086-1.001-1.551-1.464z"
						/>
						<path
							fill="#000"
							d="M79.198 65.304c.065-.043.112-.054.152-.041.231-.076.473-.181.721-.301.973-1.713 1.327-3.857 1.365-5.459-.633-.521-1.031-1.275-1.568-1.898-.423-.16-.789-.376-.967-.781-.718-.354-1.561-.458-2.395-.418l-.177.013a8.317 8.317 0 00-.674.077c-.592 1.559-1.685 2.617-2.198 4.254 1.127 2.634 2.726 5.433 5.741 4.554z"
						/>
					</MovingEyes>
				</Fragment>
			)}
		</Fragment>
	);
};

function eyeLook(props: any) {
	return keyframes`
		0% {
			transform: translate3d(0, 0, 0);
		}
		100% {
			/* Randomly look left or right */
			transform: translate3d(${props.eyedirection}, 0, 0);
		}
	`;
}

const MovingEyes = styled.g<IEyes>`
	animation: ${(props: IEyes) => eyeLook} 2s steps(2, end) infinite;
`;

interface IEyes {
	eyedirection: string;
}

export default Eyes;
